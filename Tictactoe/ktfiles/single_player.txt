package com.example.pawangolyal.game2

import android.content.DialogInterface
import android.content.Intent
import android.graphics.Color
import android.os.Bundle
import android.os.Handler
import android.support.v7.app.AlertDialog
import android.support.v7.app.AppCompatActivity
import android.view.View
import android.widget.Button
import android.widget.Toast
import kotlinx.android.synthetic.main.activity_startgame.*
import java.util.*


class single : AppCompatActivity() {
    lateinit var buttons: Array<Button>
     lateinit var bu:Array<Button>
    var count=0
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_startgame)



        buttons= arrayOf(bu1,bu2,bu3,bu4,bu5,bu6,bu7,bu8,bu9)
        new1.setOnClickListener{
            for(i in buttons) {
                i.isEnabled=true
                i.text=""
                winner=-1
                player1.clear()
                player2.clear()
                count=0

            }


        }

        home1.setOnClickListener{
         var intent= Intent(this,tic3::class.java)
            startActivity(intent)
            finish()


        }

    }


    fun bu(view: View) {
        count++

        if(count==9 && winner!=1 && winner!=2)
        {
            Toast.makeText(this, "Congrats this is a draw", Toast.LENGTH_LONG).show()


        }
        val buSelected = view as Button
        var cellID = 0
        when (buSelected.id) {
            R.id.bu1 -> cellID = 1
            R.id.bu2 -> cellID = 2
            R.id.bu3 -> cellID = 3
            R.id.bu4 -> cellID = 4
            R.id.bu5 -> cellID = 5
            R.id.bu6 -> cellID = 6
            R.id.bu7 -> cellID = 7
            R.id.bu8 -> cellID = 8
            R.id.bu9 -> cellID = 9

        }

//        Toast.makeText(this, "Cell ID" + cellID, Toast.LENGTH_LONG).show()
        playGame(cellID,buSelected)
    }

    var player1=ArrayList<Int>()
    var player2=ArrayList<Int>()
    var activePlayer=1

    private fun playGame(cellID: Int, buSelected: Button) {
        if(activePlayer==1) {
            buSelected.text="X"
            player1.add(cellID)
            activePlayer = 2



            var handler= Handler()


            var rundata= Runnable {

                AutoPlay()

            }

            handler.postDelayed(rundata,1000)



        }else
        {
            buSelected.text="O"
            player2.add(cellID)
            activePlayer = 1

        }

      //  if(buSelected.isEnabled==false) {
            // Toast.makeText(this,"congrats this is a draw ", Toast.LENGTH_LONG).show()
            //var dialog = AlertDialog.Builder(this)
            //dialog.setMessage("Player1 won")

            //dialog.setNeutralButton("OK", DialogInterface.OnClickListener { dialogInterface, i ->

              //  onResume()

           // })
           // dialog.show()
        //}


        buSelected.isEnabled=false
        checkWinner()



    }
    var winner=-1
    private fun checkWinner() {

        if(player1.contains(1)&&player1.contains(2)&& player1.contains(3)){
            winner=1

        }
        if(player2.contains(1)&&player2.contains(2)&& player2.contains(3)){
            winner=2
        }


        if(player1.contains(4)&&player1.contains(5)&& player1.contains(6)){
            winner=1

        }
        if(player2.contains(4)&&player2.contains(5)&& player2.contains(6)){
            winner=2

        }
        if(player1.contains(7)&&player1.contains(8)&& player1.contains(9)){
            winner=1

        }
        if(player2.contains(7)&&player2.contains(8)&& player2.contains(9)){
            winner=2

        }
        if(player1.contains(1)&&player1.contains(5)&& player1.contains(9)){
            winner=1

        }
        if(player2.contains(1)&&player2.contains(5)&& player2.contains(9)){
            winner=2

        }

        if(player1.contains(3)&&player1.contains(5)&& player1.contains(7)){
            winner=1

        }
        if(player2.contains(3)&&player2.contains(5)&& player2.contains(7)){
            winner=2

        }


        if(player1.contains(1)&&player1.contains(4)&& player1.contains(7)){
            winner=1

        }
        if(player2.contains(1)&&player2.contains(4)&& player2.contains(7)){
            winner=2

        }

        if(player1.contains(2)&&player1.contains(5)&& player1.contains(8)){
            winner=1

        }
        if(player2.contains(2)&&player2.contains(5)&& player2.contains(8)){
            winner=2

        }


        if(player1.contains(3)&&player1.contains(6)&& player1.contains(9)){
            winner=1

        }
        if(player2.contains(3)&&player2.contains(6)&& player2.contains(9)){
            winner=2

        }


        if(winner!=-1)
        {
            if(winner==1)
            {


                var handler= Handler()



                var rundata= Runnable {

                    // Toast.makeText(this,"Player 1 has won the game congrats",Toast.LENGTH_LONG).show()
                    var dialog = AlertDialog.Builder(this)
                    dialog.setMessage("Player1 won")

                    dialog.setNeutralButton("OK", DialogInterface.OnClickListener { dialogInterface, i ->

                        onResume()

                    })
                    dialog.show()


                }

                handler.postDelayed(rundata,2000)






            }else
            {

                //  Toast.makeText(this,"Player 2 has won the game congrats",Toast.LENGTH_LONG).show()
                var dialog = AlertDialog.Builder(this)
                dialog.setMessage("Player2 won")

                dialog.setNeutralButton("OK", DialogInterface.OnClickListener { dialogInterface, i ->

                    onResume()

                })
                dialog.show()
            }

        }


    }
    //@Suppress("DEPRECATION")
    private fun AutoPlay() {
        var emptyCells = ArrayList<Int>()
        for (cellID in 1..9) {
            if (!(player1.contains(cellID) || player2.contains(cellID))) {
                emptyCells.add(cellID)

            }
        }
        val r = Random()
        val randIndex = r.nextInt(emptyCells.size-0)+0
        val cellID=emptyCells[randIndex]

        val buSelected:Button

        when(cellID) {
            1->buSelected = bu1
            2->buSelected = bu2
            3->buSelected =bu3
            4->buSelected=bu4
            5->buSelected=bu5
            6->buSelected=bu6
            7->buSelected=bu7
            8->buSelected=bu8
            9->buSelected=bu9
            else-> buSelected=bu1
        }
        playGame(cellID,buSelected)


    }
}



















